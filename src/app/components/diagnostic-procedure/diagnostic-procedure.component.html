<div class="diagnostic-procedure-container">
  <!-- Diagnostic Header -->
  <div class="diagnostic-header">
    <div class="header-content">
      <div class="fault-info">
        <h2>Diagnostic Procedure</h2>
        <div class="fault-codes-display" *ngIf="faultCode">
          <span class="code-badge spn">{{ formatSPN(faultCode.spn) }}</span>
          <span class="code-badge fmi">{{ formatFMI(faultCode.fmi) }}</span>
          <span class="severity-badge" [ngClass]="getSeverityClass(faultCode.severity)">
            {{ faultCode.severity }}
          </span>
          <span class="urgency-badge" [ngClass]="getUrgencyClass(faultCode.urgencyLevel)">
            {{ faultCode.urgencyLevel.replace('_', ' ') }}
          </span>
        </div>
      </div>
      
      <div class="progress-section">
        <div class="progress-stats">
          <div class="stat">
            <span class="stat-value">{{ completedSteps.size }}/{{ steps.length }}</span>
            <span class="stat-label">Steps Complete</span>
          </div>
          <div class="stat">
            <span class="stat-value">{{ estimatedTimeRemaining }}</span>
            <span class="stat-label">Est. Time Remaining</span>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="progressPercentage"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation Tabs -->
  <div class="diagnostic-tabs">
    <div class="tabs-nav">
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'overview'"
        (click)="setActiveTab('overview')">
        Overview
      </button>
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'steps'"
        (click)="setActiveTab('steps')">
        Diagnostic Steps
      </button>
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'tools'"
        (click)="setActiveTab('tools')">
        Required Tools
      </button>
      <button 
        class="tab-button" 
        [class.active]="activeTab === 'safety'"
        (click)="setActiveTab('safety')">
        Safety Warnings
      </button>
    </div>
  </div>

  <!-- Tab Content -->
  <div class="tab-content">
    <!-- Overview Tab -->
    <div class="overview-content" *ngIf="activeTab === 'overview' && faultCode">
      <div class="info-grid">
        <div class="info-card">
          <h3>Fault Description</h3>
          <p>{{ faultCode.description }}</p>
          <p class="meaning">{{ faultCode.meaning }}</p>
        </div>
        
        <div class="info-card">
          <h3>Affected Components</h3>
          <ul class="component-list">
            <li *ngFor="let component of faultCode.affectedComponents">
              {{ component }}
            </li>
          </ul>
        </div>
        
        <div class="info-card">
          <h3>Common Symptoms</h3>
          <ul class="symptom-list">
            <li *ngFor="let symptom of faultCode.symptoms">
              {{ symptom }}
            </li>
          </ul>
        </div>
        
        <div class="info-card">
          <h3>Possible Causes</h3>
          <ul class="cause-list">
            <li *ngFor="let cause of faultCode.possibleCauses">
              {{ cause }}
            </li>
          </ul>
        </div>
      </div>
      
      <div class="action-info" *ngIf="faultCode.canContinueDriving !== undefined">
        <div class="driving-status" [class.safe]="faultCode.canContinueDriving" 
             [class.unsafe]="!faultCode.canContinueDriving">
          <span class="status-icon"></span>
          <div class="status-text">
            <h4>{{ faultCode.canContinueDriving ? 'Can Continue Driving' : 'Stop Immediately' }}</h4>
            <p *ngIf="faultCode.distanceToService">
              Maximum distance: {{ faultCode.distanceToService }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Diagnostic Steps Tab -->
    <div class="steps-content" *ngIf="activeTab === 'steps'">
      <div class="steps-timeline">
        <div class="step-card" 
             *ngFor="let step of steps"
             [class.completed]="isStepComplete(step.stepNumber)"
             [class.active]="isStepActive(step.stepNumber)"
             (click)="selectStep(step.stepNumber)">
          
          <div class="step-indicator">
            <div class="step-number">
              <span *ngIf="!isStepComplete(step.stepNumber)">{{ step.stepNumber }}</span>
              <span *ngIf="isStepComplete(step.stepNumber)" class="check-icon">‚úì</span>
            </div>
            <div class="step-line" *ngIf="step.stepNumber < steps.length"></div>
          </div>
          
          <div class="step-content">
            <h4>Step {{ step.stepNumber }}: {{ step.description }}</h4>
            
            <div class="step-details" *ngIf="isStepActive(step.stepNumber)">
              <div class="warning-note" *ngIf="step.warningNotes">
                <span class="warning-icon">‚ö†Ô∏è</span>
                {{ step.warningNotes }}
              </div>
              
              <div class="expected-outcome" *ngIf="step.expectedOutcome">
                <h5>Expected Outcome:</h5>
                <p>{{ step.expectedOutcome }}</p>
              </div>
              
              <div class="tools-needed" *ngIf="step.toolsRequired && step.toolsRequired.length > 0">
                <h5>Tools Required:</h5>
                <ul>
                  <li *ngFor="let tool of step.toolsRequired">{{ tool }}</li>
                </ul>
              </div>
              
              <button class="complete-btn" 
                      (click)="markStepComplete(step)"
                      *ngIf="!isStepComplete(step.stepNumber)">
                Mark as Complete
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Required Tools Tab -->
    <div class="tools-content" *ngIf="activeTab === 'tools' && faultCode">
      <div class="tools-grid">
        <div class="tool-category">
          <h3>Required Tools</h3>
          <div class="tool-list">
            <div class="tool-item" *ngFor="let tool of faultCode.requiredTools">
              <span class="tool-icon">üîß</span>
              <span class="tool-name">{{ tool }}</span>
            </div>
          </div>
        </div>
        
        <div class="tool-category" *ngIf="faultCode.repairActions && faultCode.repairActions.length > 0">
          <h3>Special Tools</h3>
          <div class="tool-list">
            <div class="tool-item" 
                 *ngFor="let action of faultCode.repairActions">
              <ng-container *ngFor="let tool of action.specialTools">
                <span class="tool-icon">‚öôÔ∏è</span>
                <span class="tool-name">{{ tool }}</span>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Safety Warnings Tab -->
    <div class="safety-content" *ngIf="activeTab === 'safety' && faultCode">
      <div class="safety-warnings">
        <div class="warning-card critical" *ngIf="faultCode.safetyWarnings && faultCode.safetyWarnings.length > 0">
          <h3>‚ö†Ô∏è Safety Warnings</h3>
          <ul>
            <li *ngFor="let warning of faultCode.safetyWarnings">
              {{ warning }}
            </li>
          </ul>
        </div>
        
        <div class="warning-card info">
          <h3>üí° Preventive Measures</h3>
          <ul>
            <li *ngFor="let measure of faultCode.preventiveMeasures">
              {{ measure }}
            </li>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Bar -->
  <div class="action-bar">
    <div class="action-left">
      <button class="btn-secondary">
        Print Procedure
      </button>
      <button class="btn-secondary">
        Export PDF
      </button>
    </div>
    
    <div class="action-right">
      <button class="btn-danger" *ngIf="faultCode?.urgencyLevel === 'IMMEDIATE_STOP'">
        Emergency Stop Required
      </button>
      <button class="btn-primary" *ngIf="progressPercentage === 100">
        Complete Diagnostic
      </button>
    </div>
  </div>
</div>